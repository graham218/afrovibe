<!DOCTYPE html>
<html lang="en" data-theme="afrovibe">
  <%- include('partials/head.ejs', { pageTitle: 'Notifications' }) %>
  <body class="bg-base-100 min-h-screen flex flex-col">
    <%- include('partials/navbar.ejs') %>

    <main class="container mx-auto p-4 flex-grow">
      <input type="hidden" id="currentUserId" value="<%= currentUser._id %>">

      <header class="mb-5 flex items-center justify-between">
      <h1 class="text-lg md:text-xl font-semibold">Notifications</h1>
      <button id="markAllRead" class="btn btn-sm btn-outline">Mark all as read</button>
      </header>


      <% if ((notifications || []).length === 0) { %>
        <div class="max-w-xl mx-auto bg-base-200 rounded-xl p-8 text-center">
          <div class="flex justify-center mb-3">ğŸ””</div>
          <p>No notifications yet.</p>
        </div>
      <% } %>

      <ul id="notifList" class="space-y-2">
  <% (notifications || []).forEach(n => { %>
    <li class="p-3 rounded-2xl border border-base-300 bg-base-100 shadow-sm hover:shadow-md transition-shadow flex items-start gap-3 <%= n.read ? 'opacity-70' : '' %>"
        data-id="<%= n._id %>"
        data-ts="<%= n.createdAt.toISOString() %>">
      <div class="w-9 h-9 rounded-full bg-base-200 flex items-center justify-center shrink-0 text-sm">
        <% if (n.type === 'match') { %>ğŸ‰
        <% } else if (n.type === 'like') { %>â¤ï¸
        <% } else if (n.type === 'favorite') { %>â­
        <% } else if (n.type === 'wave') { %>ğŸ‘‹
        <% } else if (n.type === 'superlike') { %>âš¡
        <% } else { %>ğŸ””<% } %>
      </div>
      <div class="flex-1 min-w-0">
        <div class="text-[13px] leading-snug">
          <% if (n.type === 'superlike') { %>
            <span class="badge badge-xs rounded-full bg-amber-500/90 text-white border-0 mr-2">âš¡ Super-like</span>
          <% } %>
          <%= n.message || (n.type.charAt(0).toUpperCase() + n.type.slice(1)) %>
        </div>
        <div class="text-[11px] opacity-70 mt-0.5"><%= new Date(n.createdAt).toLocaleString() %></div>
      </div>
      <div class="flex items-center gap-2 shrink-0">
        <% if (!n.read) { %>
          <form method="post" action="/notifications/<%= n._id %>/mark-read">
            <button class="btn btn-ghost btn-2xs">Mark read</button>
          </form>
        <% } %>
        <button class="btn btn-outline btn-2xs dismiss-btn" data-id="<%= n._id %>">Dismiss</button>
      </div>
    </li>
  <% }) %>
</ul>


      <div id="loadingMore" class="text-center py-4 opacity-70 hidden">Loadingâ€¦</div>
    </main>

    <%- include('partials/footer.ejs') %>

    <!-- Scripts (CSP-safe order) -->
    <script nonce="<%= cspNonce %>" src="/js/socket.helper.js" defer></script>
    <script nonce="<%= cspNonce %>" src="/js/global.js" defer></script>
    <script nonce="<%= cspNonce %>" src="/js/page-notifications.js" defer></script>
  </body>
</html>
