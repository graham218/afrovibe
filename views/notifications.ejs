<!DOCTYPE html>
<html lang="en" data-theme="afrovibe">
  <%- include('partials/head.ejs', { pageTitle: 'Notifications' }) %>
  <body class="min-h-screen flex flex-col bg-black text-white selection:bg-[#FECA57]/30 selection:text-white">

    <!-- Navbar (unchanged include) -->
    <%- include('partials/navbar.ejs') %>

    <!-- Page backdrop (only for this page area) -->
    <main class="relative isolation-isolate z-10 flex-1">
      <!-- soft gradient glow behind content -->
      <div aria-hidden="true"
           class="pointer-events-none absolute inset-0 -z-10
                  bg-[radial-gradient(60%_50%_at_50%_0%,rgba(255,107,107,.12),transparent_60%),radial-gradient(60%_40%_at_80%_100%,rgba(254,202,87,.10),transparent_60%)]">
      </div>

      <div class="container mx-auto px-4 md:px-6 lg:px-8 py-6 md:py-10">
        <input type="hidden" id="currentUserId" value="<%= currentUser._id %>">

        <!-- Header -->
        <header class="mb-6 md:mb-8 flex items-center justify-between">
          <h1 class="text-2xl md:text-3xl font-extrabold tracking-tight">
            <span class="bg-gradient-to-r from-[#FF6B6B] to-[#FECA57] bg-clip-text text-transparent">Notifications</span>
          </h1>

          <button id="markAllRead"
                  class="btn btn-sm rounded-full border-0 text-black
                         bg-gradient-to-r from-[#FECA57] to-[#FF6B6B]
                         hover:shadow-xl hover:scale-[1.02] active:scale-100 transition">
            ‚úì Mark all read
          </button>
        </header>

        <!-- Empty state -->
        <% if ((notifications || []).length === 0) { %>
          <section class="max-w-2xl mx-auto">
            <div class="rounded-3xl bg-black/60 backdrop-blur-xl border border-white/10 p-10 text-center
                        shadow-[0_12px_40px_-12px_rgba(0,0,0,.6)]">
              <div class="mx-auto mb-4 w-14 h-14 grid place-items-center rounded-full
                          bg-gradient-to-r from-[#FF6B6B] to-[#FECA57] text-black text-2xl shadow-xl">üîî</div>
              <h2 class="text-xl font-semibold">You‚Äôre all caught up</h2>
              <p class="opacity-80 mt-2">No notifications yet. We‚Äôll keep this warm for you.</p>
              <a href="/dashboard"
                 class="inline-flex items-center justify-center mt-6 btn btn-sm rounded-full border-0 text-black
                        bg-gradient-to-r from-[#FECA57] to-[#FF6B6B] hover:shadow-xl transition">
                Browse matches
              </a>
            </div>
          </section>
        <% } %>

        <!-- List -->
        <ul id="notifList" class="space-y-3">
          <% (notifications || []).forEach(n => { %>
            <li class="p-3 md:p-4 rounded-3xl border border-white/10 bg-black/60 backdrop-blur-xl
                       shadow-[0_12px_40px_-12px_rgba(0,0,0,.6)]
                       hover:shadow-[0_16px_50px_-12px_rgba(0,0,0,.75)]
                       transition flex items-start gap-3 md:gap-4 <%= n.read ? 'opacity-80' : '' %>"
                data-id="<%= n._id %>"
                data-ts="<%= n.createdAt.toISOString() %>">

              <!-- Icon badge -->
              <div class="w-10 h-10 md:w-11 md:h-11 rounded-full shrink-0 grid place-items-center
                          bg-white/10 border border-white/10 text-lg md:text-xl">
                <% if (n.type === 'match') { %>üéâ
                <% } else if (n.type === 'like') { %>‚ù§Ô∏è
                <% } else if (n.type === 'favorite') { %>‚≠ê
                <% } else if (n.type === 'wave') { %>üëã
                <% } else if (n.type === 'superlike') { %>‚ö°
                <% } else { %>üîî<% } %>
              </div>

              <!-- Content -->
              <div class="flex-1 min-w-0">
                <div class="text-sm leading-snug">
                  <% if (n.type === 'superlike') { %>
                    <span class="inline-flex items-center gap-1 align-middle
                                 text-[10px] px-2 py-0.5 rounded-full border border-amber-300/40
                                 bg-gradient-to-r from-amber-400/20 to-pink-400/20">
                      <span>‚ö°</span><span>Super-like</span>
                    </span>
                  <% } %>
                  <span class="ml-1"><%= n.message || (n.type.charAt(0).toUpperCase() + n.type.slice(1)) %></span>
                </div>

                <!-- Time -->
                <div class="text-[11px] opacity-75 mt-1">
                  <%= new Date(n.createdAt).toLocaleString() %>
                </div>
              </div>

              <!-- Actions -->
              <div class="flex items-center gap-2 shrink-0">
                <% if (!n.read) { %>
                  <form method="post" action="/notifications/<%= n._id %>/mark-read">
                    <button class="btn btn-2xs rounded-full border-white/20 text-white/90
                                   hover:!bg-white/10 hover:border-white/30 transition">
                      Mark read
                    </button>
                  </form>
                <% } %>

                <button class="btn btn-2xs rounded-full border-0 text-black dismiss-btn
                               bg-gradient-to-r from-[#FECA57] to-[#FF6B6B]
                               hover:shadow-xl transition"
                        data-id="<%= n._id %>">
                  Dismiss
                </button>
              </div>
            </li>
          <% }) %>
        </ul>

        <!-- Loading more (kept id for JS) -->
        <div id="loadingMore" class="text-center py-6 opacity-80 hidden">
          <span class="inline-flex items-center gap-2 px-4 py-2 rounded-full
                       bg-white/10 border border-white/10">
            <span class="w-2 h-2 rounded-full bg-gradient-to-r from-[#FF6B6B] to-[#FECA57] animate-pulse"></span>
            Loading‚Ä¶
          </span>
        </div>
      </div>
    </main>

    <!-- Footer (unchanged include) -->
    <%- include('partials/footer.ejs') %>

    <!-- Scripts (CSP-safe order; hooks intact) -->
    <script nonce="<%= cspNonce %>" src="/js/socket.helper.js" defer></script>
    <script nonce="<%= cspNonce %>" src="/js/global.js" defer></script>
    <script nonce="<%= cspNonce %>" src="/js/page-notifications.js" defer></script>

    <!-- Motion safety: reduce aggressive animations if user prefers -->
    <style nonce="<%= cspNonce %>">
      @media (prefers-reduced-motion: reduce) {
        .hover\:scale-\[1\.02\]:hover { transform: none !important; }
        .animate-pulse { animation: none !important; }
      }
    </style>
  </body>
</html>
