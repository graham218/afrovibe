<!DOCTYPE html>
<html lang="en" data-theme="afrovibe">
  <head>
    <%- include('partials/head.ejs', { pageTitle: 'Advanced Search' }) %>
    <style>
      /* Force dark native controls across browsers */
      :root { color-scheme: dark; }
      /* Inputs / selects / textareas on black glass */
      input.input, select.select, textarea.textarea {
        background-color: rgba(15,15,15,0.85) !important;
        color: #fff !important;
        border-color: rgba(255,255,255,0.16) !important;
      }
      input.input::placeholder,
      textarea.textarea::placeholder {
        color: rgba(255,255,255,0.60) !important;
      }
      /* Native select list items in dark mode (Chrome/Firefox) */
      select.select option {
        background: #0b0b0b;
        color: #fff;
      }
      /* Improve focus visibility */
      input.input:focus, select.select:focus, textarea.textarea:focus {
        outline: none !important;
        box-shadow: 0 0 0 2px rgba(254,202,87,0.35) !important;
        border-color: rgba(254,202,87,0.55) !important;
      }
      /* Tiny label boost */
      .label-text { color: rgba(255,255,255,0.90) !important; }
    </style>
  </head>

  <!-- Deep black canvas with subtle gradient depth -->
  <body class="bg-black text-white min-h-screen relative">
    <!-- page-only ambient glow (keeps navbar/footer readable) -->
    <div aria-hidden="true"
         class="pointer-events-none absolute inset-0 -z-10
                bg-[radial-gradient(60%_45%_at_20%_0%,rgba(255,107,107,.12),transparent_60%),radial-gradient(55%_40%_at_90%_100%,rgba(254,202,87,.10),transparent_60%)]">
    </div>

    <!-- Navbar (unchanged so it stays readable across pages) -->
    <%- include('partials/navbar.ejs') %>

    <main class="relative isolation-isolate max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 md:py-10">
      <!-- Page header -->
      <div class="flex items-center justify-between mb-6 md:mb-8">
        <h1 class="text-2xl md:text-3xl font-extrabold tracking-tight">
          <span class="bg-gradient-to-r from-[#FF6B6B] to-[#FECA57] bg-clip-text text-transparent">Advanced Search</span>
        </h1>
        <div class="flex items-center gap-2">
          <a href="/advanced-search"
             class="btn btn-ghost btn-sm rounded-full text-white/85 hover:bg-white/10">Reset</a>
          <a href="/dashboard"
             class="btn btn-ghost btn-sm rounded-full text-white/85 hover:bg-white/10">‚Üê Discover</a>
        </div>
      </div>

      <!-- Layout -->
      <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">
        <!-- Filters (glass form) -->
        <aside class="lg:col-span-12">
          <!-- Submit to dashboard with GET so the Discover feed uses these filters -->
          <form method="get" action="/dashboard"
                class="rounded-3xl bg-black/60 backdrop-blur-xl border border-white/10 shadow-[0_12px_40px_-12px_rgba(0,0,0,.6)] hover:shadow-[0_16px_50px_-12px_rgba(0,0,0,.75)] transition-shadow">
            <div class="p-4 sm:p-6 md:p-8">
              <h2 class="text-lg md:text-xl font-semibold mb-4">
                <span class="bg-gradient-to-r from-[#FF6B6B] to-[#FECA57] bg-clip-text text-transparent">
                  Search for Your Matches
                </span>
              </h2>

              <!-- Row 1: Gender + Age -->
              <div class="grid grid-cols-1 sm:grid-cols-3 gap-3">
                <label class="form-control">
                  <span class="label-text">I‚Äôm looking for</span>
                  <select name="seekingGender"
                          class="select select-bordered text-white [color-scheme:dark]">
                    <option value="Any"        <%= filters.seekingGender==='Any' ? 'selected' : '' %>>Any</option>
                    <option value="Male"       <%= filters.seekingGender==='Male' ? 'selected' : '' %>>Male</option>
                    <option value="Female"     <%= filters.seekingGender==='Female' ? 'selected' : '' %>>Female</option>
                    <option value="Non-binary" <%= filters.seekingGender==='Non-binary' ? 'selected' : '' %>>Non-binary</option>
                  </select>
                </label>

                <label class="form-control">
                  <span class="label-text">Age (min)</span>
                  <select name="minAge" class="select select-bordered text-white [color-scheme:dark]">
                    <option value=""></option>
                    <% for (let a=18; a<=80; a++) { %>
                      <option value="<%= a %>" <%= String(filters.minAge||'')===String(a) ? 'selected' : '' %>><%= a %></option>
                    <% } %>
                  </select>
                </label>

                <label class="form-control">
                  <span class="label-text">Age (max)</span>
                  <select name="maxAge" class="select select-bordered text-white [color-scheme:dark]">
                    <option value=""></option>
                    <% for (let a=18; a<=80; a++) { %>
                      <option value="<%= a %>" <%= String(filters.maxAge||'')===String(a) ? 'selected' : '' %>><%= a %></option>
                    <% } %>
                  </select>
                </label>
              </div>

              <!-- Row 2: Location -->
              <div class="grid grid-cols-1 sm:grid-cols-3 gap-3 mt-4">
                <label class="form-control">
                  <span class="label-text">Country</span>
                  <input name="country"
                         class="input input-bordered"
                         placeholder="Any" value="<%= filters.country || '' %>">
                </label>
                <label class="form-control">
                  <span class="label-text">State / Province</span>
                  <input name="stateProvince"
                         class="input input-bordered"
                         value="<%= filters.stateProvince || '' %>">
                </label>
                <label class="form-control">
                  <span class="label-text">City</span>
                  <input name="city"
                         class="input input-bordered"
                         value="<%= filters.city || '' %>">
                </label>
              </div>

              <!-- Row 3: Distance + Sort (with premium locks) -->
              <div class="grid grid-cols-1 sm:grid-cols-3 gap-3 mt-4">
                <label class="form-control">
                  <span class="label-text flex items-center gap-2">
                    Radius (km)
                    <% if (premiumLocks && premiumLocks.radius && planOf(currentUser) === 'free') { %>
                      <span class="badge badge-warning badge-outline">üîí</span>
                    <% } %>
                  </span>
                  <input
                    name="radiusKm" type="number" min="0"
                    class="input input-bordered"
                    value="<%= filters.radiusKm || '' %>"
                    <% if (premiumLocks && premiumLocks.radius && planOf(currentUser)==='free') { %>
                      data-locked="Radius"
                    <% } %>
                  >
                </label>

                <label class="form-control sm:col-span-2">
                  <span class="label-text flex items-center gap-2">
                    Sort by
                    <% if (premiumLocks && premiumLocks.distanceSort && planOf(currentUser) === 'free') { %>
                      <span class="badge badge-warning badge-outline">üîí distance</span>
                    <% } %>
                  </span>
                  <select name="sort"
                          class="select select-bordered text-white [color-scheme:dark]"
                          <%= (premiumLocks && premiumLocks.distanceSort && planOf(currentUser)==='free') ? 'data-lock-distance' : '' %>>
                    <option value="active"   <%= filters.sort==='active' ? 'selected' : '' %>>Recently active</option>
                    <option value="recent"   <%= filters.sort==='recent' ? 'selected' : '' %>>Newest members</option>
                    <option value="ageAsc"   <%= filters.sort==='ageAsc' ? 'selected' : '' %>>Age ‚Üë</option>
                    <option value="ageDesc"  <%= filters.sort==='ageDesc' ? 'selected' : '' %>>Age ‚Üì</option>
                    <option value="distance"
                      <%= filters.sort==='distance' ? 'selected' : '' %>
                      <%= (premiumLocks && premiumLocks.distanceSort && planOf(currentUser)==='free') ? 'disabled' : '' %>
                    >Distance</option>
                  </select>
                </label>
              </div>

              <!-- Quick toggles -->
              <div class="mt-5 grid grid-cols-1 sm:grid-cols-3 gap-3">
                <label class="flex items-center gap-2 cursor-pointer">
                  <input type="checkbox" class="checkbox checkbox-primary checkbox-sm"
                         name="verifiedOnly" value="1" <%= filters.verifiedOnly==='1' ? 'checked' : '' %> />
                  <span class="text-white/90">Verified only</span>
                </label>

                <label class="flex items-center gap-2 cursor-pointer">
                  <input type="checkbox" class="checkbox checkbox-primary checkbox-sm"
                         name="onlineNow" value="1" <%= filters.onlineNow==='1' ? 'checked' : '' %> />
                  <span class="text-white/90">Online now</span>
                </label>

                <label class="flex items-center gap-2 cursor-pointer">
                  <input type="checkbox" class="checkbox checkbox-primary checkbox-sm"
                         name="hasPhoto" value="1" <%= filters.hasPhoto==='1' ? 'checked' : '' %> />
                  <span class="text-white/90">Has photo</span>
                </label>
              </div>

              <!-- Minimum photos -->
              <div class="mt-4">
                <label class="form-control">
                  <span class="label-text flex items-center gap-2">
                    Minimum photos
                    <% if (premiumLocks && premiumLocks.minPhotos && planOf(currentUser) === 'free') { %>
                      <span class="badge badge-warning badge-outline">üîí</span>
                    <% } %>
                  </span>
                  <select name="minPhotos"
                          class="select select-bordered text-white [color-scheme:dark]"
                          <%= (premiumLocks && premiumLocks.minPhotos && planOf(currentUser)==='free') ? 'data-locked="Min photos"' : '' %>>
                    <option value="">Any</option>
                    <option value="2" <%= filters.minPhotos==='2'?'selected':'' %>>2+</option>
                    <option value="3" <%= filters.minPhotos==='3'?'selected':'' %>>3+</option>
                    <option value="4" <%= filters.minPhotos==='4'?'selected':'' %>>4+</option>
                  </select>
                </label>
              </div>

              <!-- Search text + interests -->
              <div class="mt-4 grid grid-cols-1 sm:grid-cols-2 gap-3">
                <label class="form-control">
                  <span class="label-text">Keyword</span>
                  <input name="q" class="input input-bordered"
                         placeholder="bio, username‚Ä¶" value="<%= filters.q || '' %>">
                </label>
                <label class="form-control">
                  <span class="label-text">Interests</span>
                  <input name="interests" class="input input-bordered"
                         placeholder="music, sports‚Ä¶" value="<%= filters.interests || '' %>">
                </label>
              </div>

              <!-- Cultural -->
              <div class="mt-8">
                <h3 class="font-semibold mb-2 text-white/90">Cultural</h3>
                <div class="grid grid-cols-1 sm:grid-cols-3 gap-3">
                  <label class="form-control">
                    <span class="label-text">Religion</span>
                    <input name="religion" class="input input-bordered"
                           value="<%= filters.religion || '' %>">
                  </label>
                  <label class="form-control">
                    <span class="label-text">Denomination</span>
                    <input name="denomination" class="input input-bordered"
                           value="<%= filters.denomination || '' %>">
                  </label>
                  <label class="form-control sm:col-span-3">
                    <span class="label-text flex items-center gap-2">
                      Languages (CSV)
                      <% if (premiumLocks && premiumLocks.languages && planOf(currentUser) === 'free') { %>
                        <span class="badge badge-warning badge-outline">üîí</span>
                      <% } %>
                    </span>
                    <input name="languages"
                           class="input input-bordered"
                           placeholder="English, Swahili"
                           value="<%= Array.isArray(filters.languages)?filters.languages.join(', '):(filters.languages||'') %>"
                           <%= (premiumLocks && premiumLocks.languages && planOf(currentUser)==='free') ? 'data-locked="Languages"' : '' %>>
                  </label>
                </div>
              </div>

              <!-- Lifestyle -->
              <div class="mt-8">
                <h3 class="font-semibold mb-2 text-white/90">Lifestyle</h3>
                <div class="grid grid-cols-1 sm:grid-cols-3 gap-3">
                  <label class="form-control">
                    <span class="label-text">Education</span>
                    <input name="education" class="input input-bordered"
                           value="<%= filters.education || '' %>">
                  </label>
                  <label class="form-control">
                    <span class="label-text">Smoking</span>
                    <input name="smoking" class="input input-bordered"
                           value="<%= filters.smoking || '' %>">
                  </label>
                  <label class="form-control">
                    <span class="label-text">Drinking</span>
                    <input name="drinking" class="input input-bordered"
                           value="<%= filters.drinking || '' %>">
                  </label>
                </div>
                <% if (premiumLocks && premiumLocks.lifestyle && planOf(currentUser)==='free') { %>
                  <div class="mt-2 text-xs text-white/70">Some lifestyle filters are Premium. We‚Äôll adjust if needed.</div>
                <% } %>
              </div>

              <!-- Activity & Freshness -->
              <div class="mt-8">
                <h3 class="font-semibold mb-2 text-white/90">Activity & Freshness</h3>
                <div class="grid grid-cols-1 sm:grid-cols-3 gap-3">
                  <label class="form-control">
                    <span class="label-text">Joined within (days)</span>
                    <input name="joinedWithinDays" type="number" min="0"
                           class="input input-bordered"
                           value="<%= filters.joinedWithinDays || '' %>">
                  </label>
                  <label class="form-control">
                    <span class="label-text">Active within (min)</span>
                    <input name="activeWithinMin" type="number" min="0"
                           class="input input-bordered"
                           value="<%= filters.activeWithinMin || '' %>">
                  </label>
                  <label class="form-control">
                    <span class="label-text">Bio length ‚â•</span>
                    <input name="bioMinLen" type="number" min="0"
                           class="input input-bordered"
                           value="<%= filters.bioMinLen || '' %>">
                  </label>
                </div>
                <div class="grid grid-cols-1 sm:grid-cols-3 gap-3 mt-3">
                  <label class="form-control">
                    <span class="label-text">Prompts answered ‚â•</span>
                    <input name="promptsMin" type="number" min="0"
                           class="input input-bordered"
                           value="<%= filters.promptsMin || '' %>">
                  </label>
                  <label class="form-control sm:col-span-2">
                    <span class="label-text flex items-center gap-2">
                      Available for Video Chat
                      <% if (premiumLocks?.videoChat && planOf(currentUser)==='free') { %><span class="badge badge-outline">üîí Elite</span><% } %>
                    </span>
                    <select name="videoChat"
                            class="select select-bordered text-white [color-scheme:dark]"
                            <%= premiumLocks?.videoChat && planOf(currentUser)==='free' ? 'data-locked="Video chat"' : '' %>>
                      <option value="">Any</option>
                      <option value="1" <%= filters.videoChat==='1' ? 'selected' : '' %>>Yes</option>
                      <option value="0" <%= filters.videoChat==='0' ? 'selected' : '' %>>No</option>
                    </select>
                  </label>
                </div>
              </div>

              <!-- Social graph shortcuts -->
              <div class="mt-8">
                <h3 class="font-semibold mb-2 text-white/90">Connections</h3>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-2">
                  <label class="flex items-center gap-2 cursor-pointer">
                    <input type="checkbox" class="checkbox checkbox-primary checkbox-sm"
                           name="likedMe" value="1" <%= filters.likedMe==='1' ? 'checked' : '' %> />
                    <span class="text-white/90">People who liked me</span>
                  </label>
                  <label class="flex items-center gap-2 cursor-pointer">
                    <input type="checkbox" class="checkbox checkbox-primary checkbox-sm"
                           name="iFavorited" value="1" <%= filters.iFavorited==='1' ? 'checked' : '' %> />
                    <span class="text-white/90">I favorited</span>
                  </label>
                  <label class="flex items-center gap-2 cursor-pointer">
                    <input type="checkbox" class="checkbox checkbox-primary checkbox-sm"
                           name="mutualOnly" value="1" <%= filters.mutualOnly==='1' ? 'checked' : '' %> />
                    <span class="text-white/90">Mutual likes only</span>
                  </label>
                  <label class="flex items-center gap-2 cursor-pointer">
                    <input type="checkbox" class="checkbox checkbox-primary checkbox-sm"
                           name="unseenOnly" value="1" <%= filters.unseenOnly==='1' ? 'checked' : '' %> />
                    <span class="text-white/90">Unseen by me</span>
                  </label>
                </div>
              </div>

              <!-- Zodiac -->
              <div class="mt-8">
                <h3 class="font-semibold mb-2 text-white/90 flex items-center justify-between">
                  <span>Zodiac Signs</span>
                  <a href="#" class="link text-sm text-white/85 hover:text-white" data-action="zodiac-select-all">Select all</a>
                </h3>
                <div class="grid grid-cols-2 gap-x-4 gap-y-2">
                  <% const z = ['Aries','Taurus','Gemini','Cancer','Leo','Virgo','Libra','Scorpio','Sagittarius','Capricorn','Aquarius','Pisces']; %>
                  <% for (const sign of z) { %>
                    <label class="flex items-center gap-2 cursor-pointer">
                      <input type="checkbox" class="checkbox checkbox-primary checkbox-sm"
                             name="zodiac[]" value="<%= sign %>"
                             <%= Array.isArray(filters.zodiac) && filters.zodiac.includes(sign) ? 'checked' : '' %> />
                      <span class="text-white/90"><%= sign %></span>
                    </label>
                  <% } %>
                </div>

                <label class="flex items-center gap-2 cursor-pointer mt-3">
                  <input type="checkbox" class="checkbox checkbox-primary checkbox-sm"
                         name="compatibleZodiac" value="1" <%= filters.compatibleZodiac==='1' ? 'checked' : '' %> />
                  <span class="text-white/90">Show only the Zodiac signs that are compatible with me</span>
                </label>
              </div>

              <!-- Submit -->
              <div class="mt-8 flex items-center gap-2">
                <button
                  class="btn rounded-full text-black border-0 bg-gradient-to-r from-[#FF6B6B] to-[#FECA57]
                         hover:shadow-xl hover:scale-[1.02] transition"
                  type="submit">
                  <span class="mr-1">‚ù§Ô∏è</span> Apply & Discover
                </button>
                <a href="/advanced-search" class="btn btn-ghost rounded-full text-white/85 hover:bg-white/10">Clear</a>
              </div>
            </div>
          </form>
        </aside>

        <!-- Per your spec, results section removed. Submitting goes to /dashboard with query params. -->
      </div>
    </main>

    <%- include('partials/footer.ejs') %>
    <script src="/js/page-advanced-search.js" defer></script>
  </body>
</html>
