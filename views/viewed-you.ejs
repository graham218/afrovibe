<!DOCTYPE html>
<html lang="en" data-theme="afrovibe">
  <%- include('partials/head.ejs', { pageTitle: 'Who Viewed You' }) %>
  <body class="bg-base-100 min-h-screen flex flex-col">
    <%- include('partials/navbar.ejs', { currentUser, unreadMessages, unreadNotificationCount }) %>

    <main class="max-w-5xl mx-auto p-4">
      <header class="mb-6 flex items-center justify-between">
        <div>
          <h1 class="text-3xl font-bold">Who Viewed You</h1>
          <p class="opacity-70 text-sm">Premium unlocks the full list of people who checked you out.</p>
        </div>

        <% if (blurred) { %>
          <div class="flex items-center gap-2">
            <a href="/upgrade" class="btn btn-primary btn-sm">Upgrade to unlock</a>
          </div>
        <% } else { %>
          <div class="flex items-center gap-2">
            <span class="badge badge-success">Unlocked</span>
            <a href="/upgrade" class="btn btn-ghost btn-sm">Manage plan</a>
          </div>
        <% } %>
      </header>

      <% if (!people || !people.length) { %>
        <div class="alert">No views yet. Be active and your profile will show up more often!</div>
      <% } %>
      <section class="grid gap-6 sm:grid-cols-3 md:grid-cols-4">
  <% (people || []).forEach(u => { %>
    <article class="card bg-base-100 border border-base-300 shadow-sm hover:shadow-md transition-shadow rounded-2xl">
      <% if (blurred) { %>
        <div class="absolute inset-0 z-10 backdrop-blur-sm bg-base-100/40 flex items-center justify-center">
          <div class="text-center">
            <div class="text-xs opacity-70 mb-2">Upgrade to see who viewed you</div>
            <a href="/upgrade" class="btn btn-primary btn-xs">Upgrade</a>
          </div>
        </div>
      <% } %>

      <figure class="overflow-hidden">
        <img src="<%= (u.profile?.photos?.[0] || '/img/placeholder.png') %>"
             alt="<%= u.username %>" class="w-full aspect-[4/5] object-cover">
      </figure>
      <div class="p-3">
        <h3 class="text-[16px] font-semibold leading-tight truncate"><%= u.username %></h3>
        <div class="text-xs opacity-70 mt-1">
          <%= u.profile?.age ? (u.profile.age + ' Â· ') : '' %>
          <%= [u.profile?.city, u.profile?.country].filter(Boolean).join(', ') %>
        </div>
        <div class="mt-3 grid grid-cols-2 gap-2">
          <a class="btn btn-xs btn-ghost border border-base-300" href="/users/<%= u._id %>">View</a>
          <button class="btn btn-xs btn-outline like-btn" data-id="<%= u._id %>">ðŸ’œ Like</button>
        </div>
      </div>
    </article>
  <% }) %>
</section>

      <% if (pageMeta && pageMeta.totalPages > 1) { %>
        <div class="mt-6 flex justify-center gap-2">
          <% for (let p = 1; p <= pageMeta.totalPages; p++) { %>
            <a class="btn btn-sm <%= p === pageMeta.page ? 'btn-primary' : 'btn-ghost' %>"
               href="/viewed-you?page=<%= p %>&limit=<%= pageMeta.limit %>"><%= p %></a>
          <% } %>
        </div>
      <% } %>
    </main>
    <script nonce="<%= cspNonce %>" src="/js/socket.helper.js" defer></script>
    <script nonce="<%= cspNonce %>" src="/js/global.js" defer></script>
    <script nonce="<%= cspNonce %>" src="/js/page-dashboard.js" defer></script> <!-- if reused like handler -->

  </body>
</html>
